<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Survey of licenses used by Rust projects on crates.io</title>
  <meta name="description" content="In which I figure out which licenses Rustaceans use the most">
  <meta name="author" content="Paul Woolcock">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta property="og:title" content="Survey of licenses used by Rust projects on crates.io">
  <meta property="og:description" content="In which I figure out which licenses Rustaceans use the most">
  <meta property="og:image" content="">
  <link rel="stylesheet" href="/css/normalize.css?v=">
  <link rel="stylesheet" href="/css/skeleton.css?v=">
  <link rel="stylesheet" href="/css/style.css?v=">
  <link rel="stylesheet" href="/css/syntax.css?v=">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="/js/libs/modernizr-2.0.6.min.js"></script>
</head>
<body>
  <div class="left-side">
    <nav class="hide-on-mobile">
      <ul>
        <ul>
  <li><a href="/">Posts</a></li>
  <li><a href="/rss.xml">RSS</a></li>
  <li><a href="/blogroll.html">Blogroll</a></li>
  <li><a class="fa fa-twitter mentions-twitter" href="https://twitter.com/pauldwoolcock">@pauldwoolcock</a></li>
  <li><a class="fa fa-github mentions-github" href="https://github.com/pwoolcoc">@pwoolcoc</a></li>
  <li><a href="http://stackoverflow.com/users/35288/paul-woolcock">StackOverflow</a></li>
  <li><a href="/resume.html">Résumé</a></li>
</ul>

      </ul>
    </nav>
  </div>
  <div xmlns:dc="http://purl.org/dc/elements/1.1/" class="right-side">
    <h1 property="dc:title" class="h1">Survey of licenses used by Rust projects on crates.io</h1>
    <p>So I am working on a feature that I hope to get merged into <code class="highlighter-rouge">cargo</code>,
Rusts package manager. The feature would allow a developer to specify a
license to add to a new project (or all new projects), and automatically
put that information in their <code class="highlighter-rouge">Cargo.toml</code>, as well as add the <code class="highlighter-rouge">LICENSE</code>
file to their project.</p>

<p>So I got to the point where the feature was working, but I had to figure out
how many, and which licenses, to support in the tool. My intuition was to
include: MIT, BSD (2- and 3-clause), Apache-2.0, and GPL, both -2.0 and -3.0.</p>

<p>However, we are all about data these days, right? So forget my intuition, let’s
see what actual Rustaceans are using!</p>

<h2 id="process">Process</h2>

<p>So my first step was to collect some data from <code class="highlighter-rouge">crates.io</code>, the central repository
for Rust crates. You can easily get an index of all the crates on the site by
using the index that the Cargo team has on github:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>git clone https://github.com/crates.io-index
<span class="gp">$ </span><span class="nb">cd </span>crates.io-index</code></pre></figure>

<p>Now, lets query the <code class="highlighter-rouge">crates.io</code> API for information about these crates.
I ended up saving the information to a file, though you don’t necessarily have to
do that. It helped with iterating on the data, as I didn’t have to repeatedly hit
crates.io’s servers for the info (it saved them bandwidth, and me time, since
crates.io <em>will</em> cut you off if you make too many requests in too short a time).</p>

<p>Here is the script I used to gather the data:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">CRATE_URL</span> <span class="o">=</span> <span class="s">"https://crates.io/api/v1/crates/{crate_name}"</span>
<span class="n">INDEX_PATH</span> <span class="o">=</span> <span class="s">"/path/to/crates.io-index"</span>

<span class="k">def</span> <span class="nf">walk_index</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">fnames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span> <span class="o">==</span> <span class="s">"config.json"</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">fname</span>

<span class="k">def</span> <span class="nf">get_license</span><span class="p">(</span><span class="n">crate_name</span><span class="p">):</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CRATE_URL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">crate_name</span><span class="o">=</span><span class="n">crate_name</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">requests</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">crate</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s">'crate'</span><span class="p">]</span>
            <span class="n">license</span> <span class="o">=</span> <span class="n">crate</span><span class="p">[</span><span class="s">'license'</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">license</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">license</span> <span class="o">=</span> <span class="n">license</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">license</span>
        <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"license.csv"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s">""</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s">'excel'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">crate_name</span> <span class="ow">in</span> <span class="n">walk_index</span><span class="p">(</span><span class="n">INDEX_PATH</span><span class="p">):</span>
        <span class="n">license</span> <span class="o">=</span> <span class="n">get_license</span><span class="p">(</span><span class="n">crate_name</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">crate_name</span><span class="p">,</span> <span class="n">license</span><span class="p">])</span>
        <span class="c"># The crates.io API will cut you off if you</span>
        <span class="c"># don't throttle your requests a bit</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span></code></pre></figure>

<p>Ok, so now we have a nice <code class="highlighter-rouge">.csv</code> file with the name of the crate and the license string it
uses. Now, lets re-read that information back in, and count licenses:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">license_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"license.csv"</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s">'excel'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">crate_name</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="c"># some projects multi-license, and they almost always use a '/' to join</span>
        <span class="c"># the license names</span>
        <span class="n">licenses</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">license</span> <span class="ow">in</span> <span class="n">licenses</span><span class="p">:</span>
            <span class="c"># we just want the general class of the license,</span>
            <span class="c"># so the trailing '+' characters are unnecessary</span>
            <span class="n">cleaned</span> <span class="o">=</span> <span class="n">license</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">"+"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cleaned</span><span class="p">:</span>
                <span class="n">license_counter</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">cleaned</span><span class="p">])</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">license_counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"{x:30}{n}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">))</span></code></pre></figure>

<h2 id="results">Results</h2>

<p>So what were the results? Well, my intuition was about half correct. The top 2
most-used licenses were the MIT license and Apache-2.0. After that the number
of projects using a particular license drops off considerably, with the
BSD-3-Clause coming in 3rd. The Mozilla Public License came in 4th. I did not
have the MPL on my list, which was obviously foolish, considering Rust is a
Mozilla project. “non-standard” came in 5th, but that is kind of a wash because
it appears to be a kind of “default value” that cargo (or crates.io) gives the
project when they don’t have a “license” key in their configuration, but rather
a “license-file” which has a path. The handful of these that I looked at were
using MIT, but just didn’t name it in their <code class="highlighter-rouge">Cargo.toml</code> configs. It made me
chuckle, but the “Unlicense” came in 6th. The GPL-3.0 is at 7, and the
BSD-2-Clause at 8th.  So all the licenses from my list were in the top 8, but
were definitely not the top 5. Here is a table of my counts:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    mit                           2333
    apache-2.0                    488
    bsd-3-clause                  63
    mpl-2.0                       52
    non-standard                  52
    unlicense                     49
    gpl-3.0                       47
    bsd-2-clause                  40
    cc0-1.0                       38
    lgpl-3.0                      31
    zlib                          26
    isc                           24
    wtfpl                         23
    lgpl-2.1                      19
    gpl-2.0                       18
    bsl-1.0                       15
    agpl-3.0                      9
    aml                           4
    cc-by-nc-4.0                  2
    python-2.0                    2
    apache-1.0                    1
    agpl-1.0                      1
    lgpl-2.0                      1
    nlpl                          1
    ncsa                          1
    zlib-acknowledgement          1
    ijg                           1
    libpng                        1
    mpl-2.0-no-copyleft-exception 1
    zed                           1
    miros                         1
    mpl-1.1                       1
</code></pre>
</div>

<h2 id="conclusion">Conclusion</h2>

<p>Given the results, I am probably going to take the GPL-3.0 and BSD-2-Clause out
of my PR, and add the MPL in. The “Unlicense” seems to be slightly controversial
(at least from the little digging I did on the internet), but I don’t want to
exclude it while including licenses that were represented less in the data, so
taking the top 4 instead of the top 5 seems more fair.</p>

<p>I am not sure if the cargo devs will be interested in my feature when I get a
PR opened, but either way I enjoyed this quick little dip into the crates.io
ecosystem.</p>

<h4 id="notes">Notes</h4>

<p>If you want to see the data I worked from, and the scripts I used, there
is a git repo up with all the files, at
<a href="https://github.com/pwoolcoc/crates.io-license-survey">https://github.com/pwoolcoc/crates.io-license-survey</a></p>
<br/>
	<div class="italic">
	- <span class="signature" property="dc:creator">Paul Woolcock</span>, <span property="dc:date">24 Sep 2015</span>
	</div>
    <a href="/changelogs/crates-io-license-survey.txt">Changelog</a>
	<div class="license">
		<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">
			<img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
	</div>
  </div>
  <footer>
    <nav id="mobile-menu" class="hide-on-desktop">
      <ul>
        <ul>
  <li><a href="/">Posts</a></li>
  <li><a href="/rss.xml">RSS</a></li>
  <li><a href="/blogroll.html">Blogroll</a></li>
  <li><a class="fa fa-twitter mentions-twitter" href="https://twitter.com/pauldwoolcock">@pauldwoolcock</a></li>
  <li><a class="fa fa-github mentions-github" href="https://github.com/pwoolcoc">@pwoolcoc</a></li>
  <li><a href="http://stackoverflow.com/users/35288/paul-woolcock">StackOverflow</a></li>
  <li><a href="/resume.html">Résumé</a></li>
</ul>

      </ul>
    </nav>
  </footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="/js/libs/jquery-1.7.0.min.js"><\/script>')</script>
  <!--<script defer src="/js/plugins.js"></script>
  <script defer src="/js/script.js"></script>-->
  <!--[if lt IE 7]>
    <script defer src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script defer>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->
</body>
</html>

